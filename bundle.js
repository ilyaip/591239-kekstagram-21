(()=>{"use strict";var e,t,n,o;(()=>{function e(e,t,n){n.responseType="json",n.timeout=1e4,n.addEventListener("load",(function(){200===n.status?e(n.response):t("Статус ответа: "+n.status+" "+n.statusText)})),n.addEventListener("error",(function(){t("Произошла ошибка соединения")})),n.addEventListener("timeout",(function(){t("Запрос не успел выполниться за "+n.timeout+"мс")}))}window.backend={upload:function(t,n,o){var r=new XMLHttpRequest;e(n,o,r),r.open("POST","https://21.javascript.pages.academy/kekstagram"),r.send(t)},load:function(t,n){var o=new XMLHttpRequest;e(t,n,o),o.open("GET","https://21.javascript.pages.academy/kekstagram/data"),o.send()}}})(),window.utils={getRandomElement:function(e){return e[Math.floor(Math.random()*e.length)]}},window.debounce=function(t){e&&window.clearTimeout(e),e=window.setTimeout(t,500)},(()=>{var e=[],t=[],n=["Anton","Max","Kantimir","Marusya","Toma","Joshua"],o=["Всё отлично!","В целом всё неплохо. Но не всё.","Когда вы делаете фотографию, хорошо бы убирать палец из кадра. В конце концов это просто непрофессионально.","Моя бабушка случайно чихнула с фотоаппаратом в руках и у неё получилась фотография лучше.","Я поскользнулся на банановой кожуре и уронил фотоаппарат на кота и у меня получилась фотография лучше.","Лица у людей на фотке перекошены, как будто их избивают. Как можно было поймать такой неудачный момент?!"];function r(e,t){return Math.floor(Math.random()*(t-e+1))+e}var c=function(e){for(var c=0;c<e;c++)t.push({avatar:`img/avatar-${r(1,6)}.svg`,message:o[r(0,o.length-1)],name:n[r(0,n.length-1)]})};!function(){for(var t=0;t<25;t++){var n=r(1,5);e.push({url:`photos/${t+1}.jpg`,description:"Hello",like:r(15,200),comments:c(n),commentsNumber:n})}}()})(),(()=>{var e=document.querySelector("#upload-file"),t=document.querySelector(".img-upload__preview"),n=t.querySelector("img"),o=document.querySelectorAll(".effects__preview"),r=document.querySelector(".img-upload__overlay"),c=document.querySelector("body"),i=document.querySelector("#upload-cancel"),a=document.querySelector(".scale__control--smaller"),s=document.querySelector(".scale__control--bigger"),l=document.querySelector(".scale__control--value"),d=document.querySelector(".text__hashtags"),u=document.querySelector(".text__description");window.dialog={controlSmaller:a,controlBigger:s,controlValue:l,editingForm:r};var m=function(){e.value=""},v=function(e){d!==document.activeElement&&u!==document.activeElement&&"Escape"===e.key&&(e.preventDefault(),r.classList.add("hidden"),c.classList.remove("modal-open"),u.value="",d.value="",m())};e.addEventListener("change",(function(){r.classList.remove("hidden"),c.classList.add("modal-open"),document.addEventListener("keydown",v),l.value="100%",t.style.transform="scale(1)"})),i.addEventListener("click",(function(){r.classList.add("hidden"),c.classList.remove("modal-open"),document.removeEventListener("keydown",v),m(),t.style.filter="none"}));var f=["gif","jpg","jpeg","png"];e.addEventListener("change",(function(){var t=e.files[0],r=t.name.toLowerCase();if(f.some((function(e){return r.endsWith(e)}))){var c=new FileReader;c.addEventListener("load",(function(){n.src=c.result;for(var e=0;e<o.length;e++)o[e].style.backgroundImage=`url("${c.result}")`})),c.readAsDataURL(t)}}))})(),(()=>{window.dialog.controlValue.value="100%",window.dialog.controlBigger.addEventListener("click",(function(){var e,t;t=(e=Number.parseInt(window.dialog.controlValue.value,10)+25)>=100?100:e,window.dialog.controlValue.value=t+"%",a.style.transform=`scale(${t/100})`})),window.dialog.controlSmaller.addEventListener("click",(function(){var e,t;t=(e=Number.parseInt(window.dialog.controlValue.value,10)-25)<=25?25:e,window.dialog.controlValue.value=t+"%",a.style.transform=`scale(${t/100})`}));var e,t=document.querySelector(".effect-level__pin"),n=document.querySelector(".effect-level"),o=document.querySelector(".effect-level__value"),r=document.querySelector(".img-upload__form"),c=document.querySelector("#effect-none"),i=document.querySelector(".effect-level__depth"),a=document.querySelector(".img-upload__preview"),s=document.querySelector(".effect-level__line"),l={chrome:{DEFAULT:"grayscale(1)",MIN_VALUE:"0",MAX_VALUE:"1",UNIT:""},sepia:{DEFAULT:"sepia(1)",MIN_VALUE:"0",MAX_VALUE:"1",UNIT:""},marvin:{DEFAULT:"invert(100%)",MIN_VALUE:"0",MAX_VALUE:"100",UNIT:"%"},phobos:{DEFAULT:"blur(3px)",MIN_VALUE:"0",MAX_VALUE:"3",UNIT:"px"},heat:{DEFAULT:"brightness(3)",MIN_VALUE:"1",MAX_VALUE:"3",UNIT:""},none:{DEFAULT:"none"}};function d(t){return Math.round(100*((l[e].MAX_VALUE-l[e].MIN_VALUE)*(t/s.offsetWidth)+l[e].MIN_VALUE))/100}r.addEventListener("change",(function(){c.checked?n.classList.add("hidden"):n.classList.remove("hidden")})),r.addEventListener("change",(function(n){n.target&&n.target.matches('input[type="radio"]')&&(a.style.filter=l[n.target.value].DEFAULT),e=n.target.value,t.style.left="450px",i.style.width="100%"})),t.addEventListener("mousedown",(function(n){n.preventDefault();var r=n.clientX,c=!1,u=function(n){n.preventDefault(),c=!0;var u=r-n.clientX;r=n.clientX;var m=t.offsetLeft-u;m>0&&m<s.offsetWidth&&(t.style.left=m+"px",i.style.width=100*t.offsetLeft/s.offsetWidth+"%"),function(t){switch(e){case"chrome":a.style.filter=`grayscale(${d(t)+l[e].UNIT})`;break;case"sepia":a.style.filter=`sepia(${d(t)+l[e].UNIT})`;break;case"marvin":a.style.filter=`invert(${d(t)+l[e].UNIT})`;break;case"phobos":a.style.filter=`blur(${d(t)+l[e].UNIT})`;break;case"heat":a.style.filter=`brightness(${d(t)+l[e].UNIT})`;break;case"none":a.style.filter="none"}}(m),o.value=Number.parseInt(i.style.width,10)},m=function(e){if(e.preventDefault(),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",m),c){var n=function(e){e.preventDefault(),t.removeEventListener("click",n)};t.addEventListener("click",n)}};document.addEventListener("mousemove",u),document.addEventListener("mouseup",m)}))})(),t=document.querySelector(".text__hashtags"),n=document.querySelector(".text__description"),o=/^#[a-zа-я0-9]{1,20}$/,t.addEventListener("input",(function(){for(var e=t.value.trim().toLowerCase().split(/\s+/),n=0;n<e.length;n++){var r=e[n].length;r<2?t.setCustomValidity("Хэш-тег не может состоять только из #"):r>=20?t.setCustomValidity("Хэш-тег должен содержать не польше 20-ти символов"):o.test(e[n])?n>=5?t.setCustomValidity("Нельзя указать больше 5 хэш-тегов"):t.setCustomValidity(""):t.setCustomValidity("Хэш-тег должен начинаться с # и не может содержать пробелы, спецсимволы (#, @, $ и т. п.), символы пунктуации (тире, дефис, запятая и т. п.), эмодзи и т. д."),e.filter((function(t){return t===e[n]})).length>1&&t.setCustomValidity("Хэш-теги не могут быть одинаковыми")}})),n.addEventListener("input",(function(){n.value.length>140?n.setCustomValidity("Максимум 140 символов"):n.setCustomValidity("")})),(()=>{var e,t=5,n=document.querySelector(".img-upload__overlay"),o=document.querySelector(".img-upload__form"),r=document.querySelector(".img-upload__preview"),c=document.querySelector("#picture").content.querySelector(".picture"),i=document.querySelector(".pictures"),a=document.querySelector("#success").content.querySelector(".success"),s=document.querySelector("main"),l=document.querySelector("#error").content.querySelector(".error"),d=document.querySelector(".big-picture__img"),u=d.querySelector("img"),m=document.querySelector(".likes-count"),v=document.querySelector(".social__comments"),f=document.querySelector(".social__caption"),y=document.querySelector(".comments-loader"),p=document.querySelector(".comments-count"),g=document.querySelector(".social__comment-count"),L=document.querySelector(".big-picture__cancel");function h(e){var t=document.createElement("li");v.appendChild(t),t.classList.add("social__comment");var n=document.createElement("img");t.appendChild(n),n.classList.add("social__picture"),n.src=e.avatar,n.alt=e.name;var o=document.createElement("p");t.appendChild(o),o.textContent=e.message,o.classList.add("social__text"),L.addEventListener("click",(function(){t.remove()})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&(e.preventDefault(),t.remove())}))}function _(){k.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),document.addEventListener("keydown",E)}function E(n){"Escape"===n.key&&(n.preventDefault(),k.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),t=5,y.removeEventListener("click",e))}d.addEventListener("click",(function(){_()})),window.rendercomments={errorHandler:function(e){var t=document.createElement("div");t.style="z-index: 100; margin: 0 auto; text-align: center; background-color: red;",t.style.position="absolute",t.style.left=0,t.style.right=0,t.style.fontSize="30px",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)},renderPhoto:function(n){var o=c.cloneNode(!0);o.querySelector(".picture__img").src=n.url,o.querySelector(".picture__likes").textContent=n.likes,o.querySelector(".picture__comments").textContent=n.comments.length,i.appendChild(o),o.addEventListener("click",(function(){if(g.textContent=`${t} из ${n.comments.length} комментариев`,_(),function(e){u.src=e.url,m.textContent=e.likes,f.textContent=e.description,e.comments.length<t?g.textContent=`${e.comments.length} из ${e.comments.length} комментариев`:p.textContent=e.comments.length}(n),n.comments.length<t)for(var o=0;o<n.comments.length;o++)h(n.comments[o]);else for(var r=0;r<t;r++)h(n.comments[r]);n.comments.length<=t?y.classList.add("hidden"):y.classList.remove("hidden"),e=function(){!function(e){if(e.comments.length>t)if(e.comments.length-t>5){t+=5,g.textContent=`${t} из ${e.comments.length} комментариев`;for(var n=t-5;n<t;n++)h(e.comments[n])}else{g.textContent=`${e.comments.length} из ${e.comments.length} комментариев`;for(var o=t;o<e.comments.length;o++)h(e.comments[o]);y.classList.add("hidden")}else y.classList.add("hidden")}(n)},y.addEventListener("click",e),L.addEventListener("click",(function(){k.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),document.removeEventListener("keydown",E),t=5,y.classList.remove("hidden"),y.removeEventListener("click",e)}))}))}};var w=function(e){var t=e.cloneNode(!0);s.appendChild(t),t.querySelector("button").addEventListener("click",(function(){t.classList.add("hidden")})),document.addEventListener("click",(function e(n){t.querySelector("div").contains(n.target)||(t.classList.add("hidden"),document.removeEventListener("click",e))}));var n=function(e){"Escape"===e.key&&(e.preventDefault(),t.classList.add("hidden"),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n)},S=function(){n.classList.add("hidden"),w(a),r.style.filter="none"},q=function(){w(l)};o.addEventListener("submit",(function(e){window.backend.upload(new FormData(o),S,q),e.preventDefault()}));var k=document.querySelector(".big-picture");c.addEventListener("click",(function(){k.classList.remove("hidden")}))})(),(()=>{var e=document.querySelector(".img-filters"),t=document.querySelector("#filter-default"),n=document.querySelector("#filter-random"),o=document.querySelector("#filter-discussed"),r=[];function c(){for(var e=document.querySelectorAll(".picture"),t=0;t<e.length;t++)e[t].remove()}function i(){n.classList.remove("img-filters__button--active"),t.classList.remove("img-filters__button--active"),o.classList.remove("img-filters__button--active")}t.addEventListener("click",(function(){c(),i(),window.debounce((function(){for(var e=0;e<r.length;e++)window.rendercomments.renderPhoto(r[e])})),t.classList.add("img-filters__button--active")})),n.addEventListener("click",(function(){c(),i();var e=[];e=e.concat(r),window.debounce((function(){for(var t=0;t<10;t++){const t=Math.floor(Math.random()*e.length);window.rendercomments.renderPhoto(e[t]),e.splice(t,1)}})),n.classList.add("img-filters__button--active")})),o.addEventListener("click",(function(){c(),i();var e=[];(e=e.concat(r)).sort((function(e,t){return t.comments.length-e.comments.length})),window.debounce((function(){for(var t=0;t<e.length;t++)window.rendercomments.renderPhoto(e[t])})),o.classList.add("img-filters__button--active")})),window.backend.load((function(t){r=t,e.classList.remove("img-filters--inactive"),function(e){for(var t=0;t<e.length;t++)window.rendercomments.renderPhoto(e[t])}(r)}),window.rendercomments.errorHandler)})()})();